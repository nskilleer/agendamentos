<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AgendaFácil - Login</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body class="centered-page-body">
    <div class="cardlog">
        <h1 class="text-2xl font-bold text-center text-blue-600 mb-6">AgendaFácil - Login</h1>
        <form id="login-form">
            <div class="form-group">
                <label for="email">E-mail</label>
                <input type="email" id="email" name="email" autocomplete="email" required
                    placeholder="seuemail@exemplo.com">
            </div>
            <div class="form-group">
                <label for="senha">Senha</label>
                <input type="password" id="senha" name="senha" autocomplete="current-password" required
                    placeholder="Sua senha">
            </div>
            <button type="submit" id="login-button" class="button w-full mt-4">Entrar</button>
        </form>
        <p class="text-center mt-4 text-sm">
            Não tem uma conta? <a href="/cadastro">Cadastre-se aqui</a>
        </p>
        <div id="message" class="message hidden"></div>
    </div>

    <script>
        const form = document.getElementById('login-form');
        const messageElement = document.getElementById('message');
        const loginButton = document.getElementById('login-button');

        form.addEventListener('submit', async function (e) {
            e.preventDefault();

            // Desativa o botão e mostra mensagem de carregamento
            loginButton.disabled = true;
            loginButton.innerHTML = 'Entrando... <span class="spinner"></span>';
            messageElement.classList.add('hidden');

            const email = document.getElementById('email').value;
            const senha = document.getElementById('senha').value;
            const data = { email, senha };

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data),
                    credentials: 'include'
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    messageElement.textContent = 'Login bem-sucedido! Redirecionando...';
                    messageElement.className = 'message success';
                    setTimeout(() => {
                        window.location.href = result.data.redirect;
                    }, 1000);
                } else {
                    messageElement.textContent = 'Erro no login: ' + (result.message || 'Erro desconhecido. Por favor, tente novamente.');
                    messageElement.className = 'message error';
                }
            } catch (error) {
                console.error('Erro:', error);
                messageElement.textContent = 'Erro ao se conectar com o servidor. Verifique sua conexão ou tente novamente mais tarde.';
                messageElement.className = 'message error';
            } finally {
                // Reativa o botão no final, mesmo em caso de erro
                loginButton.disabled = false;
                loginButton.innerHTML = 'Entrar';
                messageElement.classList.remove('hidden');
            }
        });
    </script>
</body>

</html>